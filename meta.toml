version = "1"

[workspace]
name = "Meta Monorepo"
root = "."

# Tool declarations
[tools.turborepo]
enabled = true
command = "turbo"
for_languages = ["typescript", "javascript"]
for_tasks = ["dev", "build", "lint", "typecheck"]

[tools.bacon]
enabled = true
command = "bacon"
for_languages = ["rust"]
for_tasks = ["dev"]

[tools.cargo]
enabled = true
command = "cargo"
for_languages = ["rust"]
for_tasks = ["build", "test", "fmt", "clippy", "audit"]

# Project definitions
[projects.api]
type = "rust"
path = "apps/api"

[projects.api.tasks]
dev = { tool = "bacon", command = "run-long" }
build = { tool = "cargo", command = "build --release" }
test = { tool = "cargo", command = "test" }

[projects.web]
type = "next"
path = "apps/web"

[projects.web.tasks]
dev = { tool = "turborepo", command = "dev --filter=@rust-v1/web" }
build = { tool = "turborepo", command = "build --filter=@rust-v1/web" }
test = { tool = "turborepo", command = "test --filter=@rust-v1/web" }

[projects.app]
type = "next"
path = "apps/app"

[projects.app.tasks]
dev = { tool = "turborepo", command = "dev --filter=@rust-v1/app" }
build = { tool = "turborepo", command = "build --filter=@rust-v1/app" }
test = { tool = "turborepo", command = "test --filter=@rust-v1/app" }

# Meta tool itself - dogfooding!
[projects.meta]
type = "rust"
path = "tooling/meta"

[projects.meta.tasks]
dev = { tool = "bacon", command = "check" }
build = { tool = "cargo", command = "build --release" }
test = { tool = "cargo", command = "test --verbose" }
fmt = { tool = "cargo", command = "fmt --all -- --check" }
fmt-fix = { tool = "cargo", command = "fmt --all" }
clippy = { tool = "cargo", command = "clippy --all-targets --all-features -- -D warnings" }
clippy-fix = { tool = "cargo", command = "clippy --all-targets --all-features --fix --allow-dirty" }
audit = { tool = "cargo", command = "audit" }
check = { tool = "cargo", command = "check --all-targets" }
